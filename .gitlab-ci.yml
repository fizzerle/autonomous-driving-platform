image: docker:stable

services:
  - docker:dind
variables:
  DOCKER_HOST: tcp://docker:2375
  DOCKER_DRIVER: overlay2
stages:
#  - build
  - deploy

#backend-maven-build:
#  image: maven:3.6.1-ibmjava-8-alpine
#  stage: build
#  script: "mvn install -Ddocker.registry=registry.gitlab.com/fizzerle/dse-2019-ss \
#           -Ddockerfile.username=gitlab-ci-token \
#           -Ddockerfile.password=$CI_BUILD_TOKEN -DskipTests -B"

kubernetes-deploy:
  image: google/cloud-sdk
  stage: deploy
  script:
    - kubectl config set-cluster e2e --server="$KUBE_URL" --certificate-authority="$KUBE_CA_PEM"
    - kubectl version
    - kubectl apply -f mongo-secret.yaml
    